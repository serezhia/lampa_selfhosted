# Lampa Self-Hosted

üé¨ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è [Lampa](https://github.com/yumata/lampa) - –º–µ–¥–∏–∞—Ü–µ–Ω—Ç—Ä–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∏ Telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π.

## üåü –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–±–æ—Ä–∫–∞** - –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ Lampa –∫–ª–æ–Ω–∏—Ä—É—é—Ç—Å—è –∏–∑ GitHub –ø—Ä–∏ —Å–±–æ—Ä–∫–µ Docker
- ‚úÖ **Hot-reload –ø–ª–∞–≥–∏–Ω–æ–≤** - —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –ø–ª–∞–≥–∏–Ω—ã –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ **Telegram Bot** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –∑–∞–∫–ª–∞–¥–∫–∏, –ø—Ä–æ—Ñ–∏–ª–∏, –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
- ‚úÖ **Sync Player** - —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Å –¥—Ä—É–∑—å—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **HTTPS** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt
- ‚úÖ **Dart Backend** - –±—ã—Å—Ç—Ä—ã–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ Dart Frog

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lampa_selfhosted/
‚îú‚îÄ‚îÄ source/                 # –ò—Å—Ö–æ–¥–Ω–∏–∫–∏ (git-tracked)
‚îÇ   ‚îú‚îÄ‚îÄ web/                # Frontend —Å–±–æ—Ä–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ patches.json    # –ü–∞—Ç—á–∏ –¥–ª—è self-hosted
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entrypoint.sh   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ custom_plugins/ # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ modification.js
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth.js
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ server/             # Backend –Ω–∞ Dart Frog
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/         # API endpoints
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/            # –ú–æ–¥–µ–ª–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ nginx/              # –®–∞–±–ª–æ–Ω—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤ nginx
‚îÇ   ‚îî‚îÄ‚îÄ jackett/            # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥–∞ Jackett
‚îÇ
‚îú‚îÄ‚îÄ data/                   # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (.gitignore)
‚îÇ   ‚îú‚îÄ‚îÄ plugins/            # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ builtin!)
‚îÇ   ‚îú‚îÄ‚îÄ nginx/              # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ nginx
‚îÇ   ‚îú‚îÄ‚îÄ database/           # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ jackett/            # –ö–æ–Ω—Ñ–∏–≥ –∏ –∏–Ω–¥–µ–∫—Å–µ—Ä—ã Jackett
‚îÇ   ‚îú‚îÄ‚îÄ torrserver/         # –ö–µ—à –∏ –∫–æ–Ω—Ñ–∏–≥ TorrServer
‚îÇ   ‚îú‚îÄ‚îÄ transcoding/        # –ö–µ—à —Ç—Ä–∞–Ω—Å–∫–æ–¥–∏–Ω–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ certs/              # SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ
‚îî‚îÄ‚îÄ docker-compose.yml      # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
```

## üîå –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤

–ü–ª–∞–≥–∏–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç **runtime overlay** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–∏ –ø–ª–∞–≥–∏–Ω—ã –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:

1. **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã** (`source/web/custom_plugins/`) - –ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–ª–∞–≥–∏–Ω—ã** (`data/plugins/`) - –≤–∞—à–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã

### –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ø–ª–∞–≥–∏–Ω

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–≤–æ–π –ø–ª–∞–≥–∏–Ω –≤ data/plugins/
cp my_plugin.js data/plugins/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ frontend
docker compose restart lampa-frontend
```

### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–ª–∞–≥–∏–Ω

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –∂–µ –∏–º–µ–Ω–µ–º –≤ `data/plugins/`:
```bash
# –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å auth.js —Å–≤–æ–µ–π –≤–µ—Ä—Å–∏–µ–π:
cp my_custom_auth.js data/plugins/auth.js

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ frontend
docker compose restart lampa-frontend
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/serezhia/lampa_selfhosted.git
cd lampa_selfhosted
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞

1. –ù–∞–ø–∏—à–∏—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot` –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```env
TELEGRAM_BOT_TOKEN=your_bot_token_here
GITHUB_REPOSITORY_OWNER=serezhia
```

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ [source/web/patches.json](source/web/patches.json):
```json
{
  "config": {
    "SELF_HOSTED_DOMAIN": "your-domain.com",
    "CUB_API_DOMAIN": "cub.rip"
  }
}
```

–ö–æ–Ω—Ñ–∏–≥ nginx –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ.

### 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose logs -f
```

### 6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ HTTPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è Let's Encrypt
./init-letsencrypt.sh
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–æ–≤

–ü–ª–∞–≥–∏–Ω—ã –≤ `data/plugins/` –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ - –¥–æ–±–∞–≤—å —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä!

```bash
# 1. –î–æ–±–∞–≤—å —Å–≤–æ–π –ø–ª–∞–≥–∏–Ω
cp my_plugin.js data/plugins/

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ frontend
docker compose restart lampa-frontend
```

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤

–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –≤ `source/web/custom_plugins/` —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏:

```bash
# 1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π –ø–ª–∞–≥–∏–Ω
nano source/web/custom_plugins/auth.js

# 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏
docker compose up -d --build lampa-frontend
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Lampa

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–µ–π –∏–∑ GitHub
docker-compose build --no-cache lampa-frontend
docker-compose up -d lampa-frontend
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [source/web/README.md](source/web/README.md) - —Å–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞, –ø–∞—Ç—á–∏, –ø–ª–∞–≥–∏–Ω—ã
- [data/README.md](data/README.md) - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## ü§ñ Telegram Bot

–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:
- `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `/add` - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- `/devices` - –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `/remove` - –£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ü–æ—á–µ–º—É —Ç–∞–∫?

**–°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥** (lampa-source –≤ —Ä–µ–ø–æ):
- ‚ùå –ì–∏–≥–∞–±–∞–π—Ç—ã –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –≤ Git
- ‚ùå –°–ª–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å
- ‚ùå –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–±–∞–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥** (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ):
- ‚úÖ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ = –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
- ‚úÖ –ü–∞—Ç—á–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ Hot-reload –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–±–æ—Ä–∫–∞

1. `Dockerfile` –∫–ª–æ–Ω–∏—Ä—É–µ—Ç `yumata/lampa-source` –∏–∑ GitHub
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–∞—Ç—á–∏ –∏–∑ `patches.json`
3. –°–æ–±–∏—Ä–∞–µ—Ç —á–µ—Ä–µ–∑ `gulp pack_github`
4. –†–µ–∑—É–ª—å—Ç–∞—Ç —É–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç—Å—è –≤ nginx –æ–±—Ä–∞–∑
5. –ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ volume

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram
- 6-–∑–Ω–∞—á–Ω—ã–µ –∫–æ–¥—ã (5 –º–∏–Ω—É—Ç TTL)
- HTTPS —á–µ—Ä–µ–∑ Let's Encrypt
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ `database.json`

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- [Lampa](https://github.com/yumata/lampa) - –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
- [Dart Frog](https://dartfrog.vgv.dev/) - backend —Ñ—Ä–µ–π–º–≤–æ—Ä–∫

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–æ–±–ª–µ–º—ã? –°–æ–∑–¥–∞–π—Ç–µ [Issue](https://github.com/serezhia/lampa_selfhosted/issues)
